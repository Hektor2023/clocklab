\href{https://gavinlyonsrepo.github.io/}{\texttt{ }} \href{https://gavinlyonsrepo.github.io//feed.xml}{\texttt{ }} \href{https://www.paypal.com/paypalme/whitelight976}{\texttt{ }}

\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md2}{}\doxysubsection{Table of contents}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md2}

\begin{DoxyItemize}
\item Overview
\item Installation
\item Features
\item Model One
\item Model Two
\item Model Three
\item Notes
\item Ports
\end{DoxyItemize}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md3}{}\doxysubsection{Overview}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md3}

\begin{DoxyItemize}
\item Name\+: \mbox{\hyperlink{class_t_m1638plus}{TM1638plus}}
\item Description\+: An Arduino library to display data on a 8-\/digit TM1638 seven segment module. This library supports 3 different models, pictured above from left to right.
\end{DoxyItemize}
\begin{DoxyEnumerate}
\item Model 1, The (8 KEY \& 8 LED) variant which has 8 LED\textquotesingle{}s and 8 Push buttons.
\item Model 2, The (QYF 16 KEY) variant which has 16 pushbuttons.
\item Model 3, The (LKM1638) variant which has 8 bi-\/colour LED\textquotesingle{}s and 8 Push buttons.
\end{DoxyEnumerate}
\begin{DoxyItemize}
\item Main Author\+: Gavin Lyons.
\item Tested on Development platforms\+:
\end{DoxyItemize}
\begin{DoxyEnumerate}
\item Arduino UNO \& NANO v3 .
\item ATtiny85 .
\item ESP32.
\item STM32 STM32\+F103\+C8\+T6 \char`\"{}the blue pill\char`\"{}.
\item ESP8266.
\item Teensy 4.\+0. (may not work at highest frequency see notes section)
\end{DoxyEnumerate}
\begin{DoxyItemize}
\item History\+: see CHANGELOG.\+md in extra folder
\end{DoxyItemize}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md4}{}\doxysubsection{Installation}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md4}
The library is included in the official Arduino library manger and the optimum way to install it is using the library manager which can be opened by the {\itshape manage libraries} option in Arduino IDE. Search \char`\"{}tm1638\char`\"{} in search bar of library manager to find it.

See link below for instruction for this and for the other methods too.

\href{https://www.arduino.cc/en/Guide/Libraries}{\texttt{ Installing Additional Arduino Libraries guide}}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md5}{}\doxysubsection{Features}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md5}
Connections to MCU\+:


\begin{DoxyEnumerate}
\item GPIO = STB = Strobe
\item GPIO = CLK = Clock
\item GPIO = DIO = Data input / output
\item GND
\item VCC
\end{DoxyEnumerate}

This library supports three variants of the TM1638, which for purposes of this documentation, will be named Model 1 ,Model 2 and Model 3. ~\newline


\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{4}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model No   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Module Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ LEDS   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Push buttons    }\\\cline{1-4}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model No   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Module Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ LEDS   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Push buttons    }\\\cline{1-4}
\endhead
1   &TM1638 LED \& KEY   &8 red only   &8    \\\cline{1-4}
2   &TM1638 KEYS, QYF   &0   &16    \\\cline{1-4}
3   &TM1638 V1.\+3 or LKM1638   &8 bi color, red and green   &8   \\\cline{1-4}
\end{longtabu}


There are two sets of files to support model 1 \& 2 . I kept them separate as the models are wired quite different, Model 1 address by digit, while Model 2 address by segment. So the code is quite different for most functions. Model 3 uses same code as Model 1, just different example file and different use of LED functions. Common settings, data and functions are in the TM1638plus\+\_\+common.\+x files.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{4}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Header   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Code file   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ TEST files    }\\\cline{1-4}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Header   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Code file   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ TEST files    }\\\cline{1-4}
\endhead
1   &\mbox{\hyperlink{_t_m1638plus_8h_source}{TM1638plus.\+h}}   &TM1638plus.\+cpp   &TM1638plus\+\_\+\+HELLOWORLD\+\_\+\+Model1.\+ino TM1638plus\+\_\+\+TEST\+\_\+\+Model1.\+ino    \\\cline{1-4}
3   &Same as model 1   &Same as model 1   &TM1638plus\+\_\+\+TEST\+\_\+\+Model3.\+ino    \\\cline{1-4}
2   &\mbox{\hyperlink{_t_m1638plus___model2_8h_source}{TM1638plus\+\_\+\+Model2.\+h}}   &TM1638plus\+\_\+\+Model2.\+cpp   &TM1638plus\+\_\+\+HELLOWORLD\+\_\+\+Model2 TM1638plus\+\_\+\+TEST\+\_\+\+Model2.\+ino   \\\cline{1-4}
\end{longtabu}
\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md6}{}\doxysubsection{Model One}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md6}
TM1638 Module 8 Push buttons 8 LEDS (LED \& KEY)





This variant consist of an 8-\/digit seven segment display with decimal points, 8 Leds and 8 Push buttons. Two 4 digit 3461AS-\/1 (.34 inch, 4 digit ,common Cathode, decimal point, RED) are used in this module giving a total of 8 digits. A TM1638 controller chip drives the unit. The unit is marked (LED \& KEY).

{\bfseries{Model 1 Library Functions}}

The commented functions can be found in library header file \mbox{\hyperlink{_t_m1638plus_8h_source}{TM1638plus.\+h}}. The library support ASCII ,text ,Hex and allows for setting individual segments, and the decimal point of segment. The TM1638plus\+\_\+\+TEST.\+ino contains a set of tests demonstrating library functions. For more information see the commented headers in header file.


\begin{DoxyEnumerate}
\item Print an ASCII character.
\item Print an ASCII character with a dot/decimal point.
\item Print a Hexadecimal digit(0-\/15).
\item Print a long integer number with or without leading zeros, and right and left aligned text.
\item Print two integer numbers (0-\/9999) to each nibble with or without leading zeros, and right and left aligned text.
\item Print a text string(dots are replaced and dot is turned on preceding digit), \char`\"{}abc.\+def\char`\"{} becomes \char`\"{}abcdef\char`\"{} with c decimal point segment switched on.
\item Read buttons status. User may have to debounce buttons depending on application. debouncing left out to minimise library size. See \href{https://github.com/gavinlyonsrepo/Arduino_Clock_3}{\texttt{ URL LINK}} for a practical real world example of using this library, including a example of debouncing the key presses. It is also possible to read multiple key presses.
\item Reset and init module functions.
\item Adjust brightness of module. Support 8 degree brightness adjustment. If user wishes to change the default brightness at start-\/up change, The DEFAULT\+\_\+\+BRIGHTNESS define in header file.
\item Manually set segments to create custom patterns.
\item Switch the 8 LEDS on and off, both a set one LED and set all LEDS methods available.
\end{DoxyEnumerate}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md7}{}\doxysubsection{Model Two}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md7}
TM1638 Module 16 Push buttons (16 KEY) (QYF).





They consist of an 8-\/digit seven segment display with decimal points, and 16 Push buttons.\+Two 4 digit 3461BS-\/1 (.34 inch, 4 digit ,common Anode, decimal point, RED)are used in this module giving a total of 8 digits. A TM1638 controller chip drives the unit. NB \+: If your display shows \char`\"{}56781234\char`\"{} for \char`\"{}12345678\char`\"{} see Notes section. Note A.

{\bfseries{Model 2 Library Functions}}

The commented functions can be found in library header file \mbox{\hyperlink{_t_m1638plus___model2_8h_source}{TM1638plus\+\_\+\+Model2.\+h}}. The library support Strings,decimal ,Hex ,raw ASCII data, setting individual segments, and the decimal point. For more detailed information on functions see commented headers in header file(.h).


\begin{DoxyEnumerate}
\item Print a Hexadecimal number with or without leading zeros, and right and left aligned text.
\item Print a decimal number with or without leading zeros, and right and left aligned text.
\item Manually set segments to create custom patterns.
\item Print two 4 digit decimal number(0-\/9999) to each nibble with or without leading zeros, and right and left aligned text.
\item Print a text string, dot function supported.
\item Read buttons status. User may want to debounce buttons depending on application. See TM1638plus\+\_\+\+ADC\+\_\+\+TEST\+\_\+\+Model2.\+ino for debounce button example. Two different functions to read buttons.
\item Reset and init module functions.
\item Adjust brightness of module. Support 8 degree brightness adjustment. If user wishes to change the default brightness at start-\/up change, The \char`\"{}\+DEFAULT\+\_\+\+BRIGHTNESS\char`\"{} define in header file.
\item Print raw ASCII data without reference to font file.
\end{DoxyEnumerate}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md8}{}\doxysubsection{Model Three}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md8}
There are different PCB\textquotesingle{}s of these modules on market, This library was tested on no 3 below. I think this software will work for all of them and the differences in PCB are related to connectors, layout and component placement. This module is a variant of Model 1. The differences are the LEDs are bigger and bi-\/color both red and green, The seven segment display is larger and extra connectors are added for Daisy chaining. Two 4 digit KYX-\/5461\+AS-\/7.\+3 (.54 inch, 4 digit ,common cathode, decimal point, RED)are used in this module giving a total of 8 digits.


\begin{DoxyEnumerate}
\item LKM1638 v1.\+1
\item LKM1638 v1.\+2
\item TM1638 V1.\+3
\end{DoxyEnumerate}



{\bfseries{Model 3 Library Functions}}

The code is the same as model 1 and there is one unique model 3 example file. set\+LED and set\+LEDs functions behaviour is the only difference in code base between 1 and 3. Set\+LED\+: The difference is when you call the set\+LED function you pass the following to get LEDs to change colour. For more detailed information on functions see commented headers in header file(.h).

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ set\+LED Value   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ result    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Model   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ set\+LED Value   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ result    }\\\cline{1-3}
\endhead
1 \& 3   &0   &LED off    \\\cline{1-3}
3   &1   &Led green on    \\\cline{1-3}
3   &2   &LED red on    \\\cline{1-3}
1   &1   &LED on   \\\cline{1-3}
\end{longtabu}


Set\+LEDs\+: When you pass call the set\+LEDs function you can pass a word pattern where upper byte is turns LEDs green on and lower byte turns LEDs red on . Model one ignores lower byte, Set to 0x00 always.


\begin{DoxyEnumerate}
\item Model 3 set\+LEDs(word) = 0x\+GGRR
\item Model 1 set\+LEDs(word) = 0x\+RR00
\end{DoxyEnumerate}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md9}{}\doxysubsection{Notes}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md9}

\begin{DoxyEnumerate}
\item Swapped data on Display issue on some Model 2 modules
\item Anomaly\textquotesingle{}s on High frequency micro-\/controllers.
\item Driving multiple displays.
\item Detecting multiple buttons pressed together.
\end{DoxyEnumerate}

{\itshape Note 1} \+: Swapped display Issue\+: Model 2 only

For Some users using this library the nibbles in information display byte where swapped around. This is because there are different versions of modules on market with different wiring. See issue \#3 on github called Swapped display \+:: \char`\"{}12345678\char`\"{} becomes \char`\"{}56781234\char`\"{}. If you test library and you see this issue, in order to fix this when you declare the Object, set the fourth parameter \char`\"{}swap\+\_\+nibbles\char`\"{} to True, The default is false.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ PCB Model noted Label   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Operation   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Object constructor 4th parameter    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ PCB Model noted Label   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Operation   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Object constructor 4th parameter    }\\\cline{1-3}
\endhead
QYF-\/\+TM1638   &default operation   &false    \\\cline{1-3}
QYF-\/\+TM1638 -\/Ver 1.\+0   &Swapped display Fix   &true   \\\cline{1-3}
\end{longtabu}


{\itshape Note 2} \+: High frequency micro-\/controllers.

This library uses a software SPI-\/like protocol and may not work fully on micro-\/controllers running at a very high frequency, without some adjustments to timing. It is a SPI-\/like interface with a single bidirectional data wire DIO. The TM1638 is basically a slow SPI device (\texorpdfstring{$<$}{<} 500k\+Hz) in DIO mode. The clock uses the equivalent of SPI mode 3 (normally high, clocks data on the rising edge). The problem is that the native Arduino shift\+In()/shift\+Out() wire functions are simply too fast for this device (technically the clock signalling for the TM1638 is inverted but as it triggers on a rising edge still it is tolerant of that). To make this work with fast devices, the shift clocking is slowed with a small delay (on the order of a microsecond). ~\newline


High\+Freqshiftin function\+:

As of version 1.\+6 a new parameter $\ast$(\+\_\+\+HIGH\+\_\+\+FREQ)$\ast$ has been introduced to constructor it is false by default. Set to true for high frequency MCU $\sim$\texorpdfstring{$>$}{>} 100Mhz. This should fix the issue of HF MCU not reading buttons correctly(ESP-\/\+Xs). The High\+\_\+\+Freq parameter causes a custom shift-\/in function to be used. The delay in this function is fixed at 1 uS, it can be changed manually by adjusted the defines in common header file.

The Teensy results have been sent in by email, I don\textquotesingle{}t have these MCU\textquotesingle{}s them at time of writing.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ IC   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ frequency   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Status    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ IC   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ frequency   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Status    }\\\cline{1-3}
\endhead
ATtiny85   &1Mhz internal   &Working    \\\cline{1-3}
Arduino UNO   &16 MHz   &Working    \\\cline{1-3}
Arduino Nano   &16 MHz   &Working    \\\cline{1-3}
STM32 \char`\"{}blue pill\char`\"{} STM32\+F103\+C8\+T6   &72Mhz   &Working    \\\cline{1-3}
ESP8266   &160Mhz   &Working    \\\cline{1-3}
ESP 32   &240 MHz   &Working, with high\+\_\+freq set to true    \\\cline{1-3}
Teensy 4.\+0   &150Mhz   &Working model 1, no Data rest of models    \\\cline{1-3}
Teensy 4.\+0   &396Mhz   &Not working on m1 pre v1.\+6, no data after, no Data rest of models   \\\cline{1-3}
\end{longtabu}


{\itshape Note 3} \+: Driving multiple displays.

It is possible to drive multiple modules. Share the DIO and CLK lines and use a unique STB line for each device. see issue number 10 at github for example code.

{\itshape Note 4} \+: Detecting multiple buttons pressed together.

Model 1 and Model 3 CAN detect multiple buttons pressed.

Model 2 has two different functions\+:


\begin{DoxyEnumerate}
\item Read\+Key16 returns a byte with decimal value 1-\/16 this function cannot detect multiple buttons pressed.
\item Read\+Key16\+Two returns a 16 bit integer where each bit corresponds to the 16 switch\textquotesingle{}s. However due to the wiring of the module, see SG-\/X lines on schematic, Pressing Certain combinations of buttons will cause the data on Seven Segments to change. So the simultaneous use of multiple key presses and the seven segments display is problematic. See issue 12 on github for more details.
\end{DoxyEnumerate}\hypertarget{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md10}{}\doxysubsection{Ports}\label{md_extra__t_m1638plus_master__t_m1638plus_master__r_e_a_d_m_e_autotoc_md10}
Micro\+Chip PIC XC8 port. \href{https://github.com/gavinlyonsrepo/pic_16F18446_projects}{\texttt{ Link}}

Stm32cube\+IDE STM32\+F303k8\+T6 C++ \href{https://github.com/gavinlyonsrepo/STM32_projects}{\texttt{ Link}}

Raspberry Pi C++ \href{https://github.com/gavinlyonsrepo/TM1638plus_RPI}{\texttt{ Link}}

RPi-\/\+PICO\+\_\+\+RP2040 SDK C++ \href{https://github.com/gavinlyonsrepo/TM1638plus_PICO}{\texttt{ Link}} 